<!DOCTYPE html>
<html>
<head></head>
<body>
<header>
    TWLY all the things
</header>
<form>
<input id="name" type="text" name="name">
<button type="button" id="submit">Analyze!</button>
</form>
<section id="results">
</section>
<footer>

</footer>
<script>
var submitBtn = document.getElementById('submit');
submitBtn.addEventListener('click', function (e) {
    var http = new XMLHttpRequest();
    var url = "/git/user";
    var name = document.getElementById('name');
    var params = "name=" + name.value;
    http.responseType = 'json';
    http.open("POST", url, true);

    //Send the proper header information along with the request
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

    http.onreadystatechange = function () { //Call a function when the state changes.
        if(http.readyState == 4 && http.status == 200) {
            displayResults(http.response);
        }
    }
    http.send(params);
});

function displayResults (results) {
    let resultContainer = document.getElementById('results');
    results.forEach((r) => {
        let resultHeading = document.createElement('header');
        let repoName = document.createElement('h1');
        let summaryHeading = document.createElement('h3');
        let detailsHeading = document.createElement('h3');
        let messages = document.createElement('ul');
        let summary = document.createElement('table');
        let tableHeaders = document.createElement('tr');
        let row = document.createElement('tr');

        repoName.textContent = r.name;
        resultHeading.appendChild(repoName);
        summaryHeading.textContent = 'Summary';
        detailsHeading.textContent = 'Details';

        r.messages.forEach((m) => {
            let pre = document.createElement('pre');
            pre.textContent = m;
            messages.appendChild(document.createElement('li').appendChild(pre));
        });
        if (r.messages.length === 0) {
            let nothing = document.createElement('li');
            nothing.textContent = 'Perfect score. You rock! Way to remember your towel.';
            messages.appendChild(nothing);
        }
        r.summary.Score = r.towelieScore + '%';
        for (let k in r.summary) {
            let tdh = document.createElement('th');
            let td = document.createElement('td');
            tdh.textContent = k;
            tableHeaders.appendChild(tdh);
            td.textContent = r.summary[k];
            row.appendChild(td);
        }
        summary.appendChild(tableHeaders);
        summary.appendChild(row);
        resultContainer.appendChild(resultHeading);
        resultContainer.appendChild(summaryHeading);
        resultContainer.appendChild(summary);
        resultContainer.appendChild(detailsHeading);
        resultContainer.appendChild(messages);
    });
}
</script>
</body>
</html>

